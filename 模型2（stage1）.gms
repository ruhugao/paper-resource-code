OPTIONS  ITERLIM=1000000, RESLIM=1000000,  OPTCR=0;


set i /1*16/;
set f /1*13/;
set u /1*11/;

alias (u,v);
alias (i,j);

parameter flag(i)
/
1     1
2     1
3     1
4     1
5     1
6     1
7     1
8     1
9     1
10    1
11    1
12    1
13    1
14    0
15    0
16    0


/;



parameter s_orr(i,u)
/
1.1        1
1.2        1
1.3        1
1.4        0
1.5        0
1.6        0
1.7        0
1.8        0
1.9        1
1.10       0
1.11       1
2.1        1
2.2        0
2.3        1
2.4        1
2.5        0
2.6        0
2.7        0
2.8        1
2.9        0
2.10       0
2.11       1
3.1        1
3.2        1
3.3        1
3.4        0
3.5        1
3.6        0
3.7        0
3.8        0
3.9        0
3.10       0
3.11       1
4.1        1
4.2        0
4.3        1
4.4        1
4.5        1
4.6        0
4.7        0
4.8        0
4.9        0
4.10       0
4.11       1
5.1        1
5.2        1
5.3        1
5.4        0
5.5        1
5.6        0
5.7        0
5.8        0
5.9        0
5.10       0
5.11       1
6.1        1
6.2        0
6.3        1
6.4        0
6.5        1
6.6        1
6.7        0
6.8        1
6.9        0
6.10       0
6.11       1
7.1        1
7.2        0
7.3        1
7.4        1
7.5        1
7.6        1
7.7        0
7.8        0
7.9        0
7.10       1
7.11       1
8.1        1
8.2        0
8.3        1
8.4        0
8.5        1
8.6        0
8.7        0
8.8        1
8.9        0
8.10       0
8.11       1
9.1        1
9.2        0
9.3        1
9.4        0
9.5        1
9.6        1
9.7        0
9.8        1
9.9        0
9.10       0
9.11       1
10.1       1
10.2       1
10.3       0
10.4       1
10.5       1
10.6       1
10.7       0
10.8       0
10.9       0
10.10      0
10.11      1
11.1       1
11.2       0
11.3       0
11.4       0
11.5       0
11.6       0
11.7       0
11.8       1
11.9       0
11.10      0
11.11      1
12.1       1
12.2       1
12.3       1
12.4       0
12.5       1
12.6       1
12.7       0
12.8       1
12.9       0
12.10      0
12.11      1
13.1       1
13.2       0
13.3       1
13.4       0
13.5       1
13.6       0
13.7       0
13.8       1
13.9       0
13.10      0
13.11      1


14.1        1
14.2        1
14.3        1
14.4        1
14.5        1
14.6        1
14.7        1
14.8        1
14.9        1
14.10       1
14.11       1
15.1        1
15.2        1
15.3        1
15.4        1
15.5        1
15.6        1
15.7        1
15.8        1
15.9        1
15.10       1
15.11       1
16.1        1
16.2        1
16.3        1
16.4        1
16.5        1
16.6        1
16.7        1
16.8        1
16.9        1
16.10       1
16.11       1


/;

parameter s_des(i,v)
/
1.1        1
1.2        1
1.3        1
1.4        0
1.5        0
1.6        0
1.7        0
1.8        0
1.9        1
1.10       0
1.11       1
2.1        1
2.2        0
2.3        1
2.4        1
2.5        0
2.6        0
2.7        0
2.8        1
2.9        0
2.10       0
2.11       1
3.1        1
3.2        1
3.3        1
3.4        0
3.5        1
3.6        0
3.7        0
3.8        0
3.9        0
3.10       0
3.11       1
4.1        1
4.2        0
4.3        1
4.4        1
4.5        1
4.6        0
4.7        0
4.8        0
4.9        0
4.10       0
4.11       1
5.1        1
5.2        1
5.3        1
5.4        0
5.5        1
5.6        0
5.7        0
5.8        0
5.9        0
5.10       0
5.11       1
6.1        1
6.2        0
6.3        1
6.4        0
6.5        1
6.6        1
6.7        0
6.8        1
6.9        0
6.10       0
6.11       1
7.1        1
7.2        0
7.3        1
7.4        1
7.5        1
7.6        1
7.7        0
7.8        0
7.9        0
7.10       1
7.11       1
8.1        1
8.2        0
8.3        1
8.4        0
8.5        1
8.6        0
8.7        0
8.8        1
8.9        0
8.10       0
8.11       1
9.1        1
9.2        0
9.3        1
9.4        0
9.5        1
9.6        1
9.7        0
9.8        1
9.9        0
9.10       0
9.11       1
10.1       1
10.2       1
10.3       0
10.4       1
10.5       1
10.6       1
10.7       0
10.8       0
10.9       0
10.10      0
10.11      1
11.1       1
11.2       0
11.3       0
11.4       0
11.5       0
11.6       0
11.7       0
11.8       1
11.9       0
11.10      0
11.11      1
12.1       1
12.2       1
12.3       1
12.4       0
12.5       1
12.6       1
12.7       0
12.8       1
12.9       0
12.10      0
12.11      1
13.1       1
13.2       0
13.3       1
13.4       0
13.5       1
13.6       0
13.7       0
13.8       1
13.9       0
13.10      0
13.11      1


14.1        1
14.2        1
14.3        1
14.4        1
14.5        1
14.6        1
14.7        1
14.8        1
14.9        1
14.10       1
14.11       1
15.1        1
15.2        1
15.3        1
15.4        1
15.5        1
15.6        1
15.7        1
15.8        1
15.9        1
15.10       1
15.11       1
16.1        1
16.2        1
16.3        1
16.4        1
16.5        1
16.6        1
16.7        1
16.8        1
16.9        1
16.10       1
16.11       1


/;


parameter td(f,u)
/
1.1        185
1.2        201
1.3        215
1.4        222
1.5        229
1.6        235
1.7        242
1.8        246
1.9        255
1.10       260
2.1        198
2.2        209
2.3        221
2.4        233
2.5        242
2.6        248
2.7        255
2.8        264
2.9        270
2.10       273
3.1        208
3.2        224
3.3        238
3.4        245
3.5        257
3.6        265
3.7        272
3.8        276
3.9        280
3.10       283
4.1        231
4.2        242
4.3        254
4.4        266
4.5        280
4.6        288
4.7        295
4.8        300
4.9        304
4.10       307
5.1        236
5.2        252
5.3        266
5.4        272
5.5        285
5.6        293
5.7        300
5.8        304
5.9        308
5.10       311
6.1        246
6.2        258
6.3        271
6.4        278
6.5        291
6.6        305
6.7        314
6.8        323
6.9        330
6.10       334
7.1        257
7.2        268
7.3        280
7.4        292
7.5        306
7.6        319
7.7        328
7.8        332
7.9        336
7.10       344
8.1        276
8.2        287
8.3        299
8.4        306
8.5        318
8.6        326
8.7        333
8.8        342
8.9        348
8.10       351
9.1        305
9.2        316
9.3        328
9.4        335
9.5        352
9.6        365
9.7        374
9.8        383
9.9        389
9.10       392
10.1       314
10.2       334
10.3       343
10.4       353
10.5       367
10.6       380
10.7       389
10.8       393
10.9       397
10.10      400
11.1       320
11.2       331
11.3       338
11.4       343
11.5       350
11.6       356
11.7       363
11.8       372
11.9       378
11.10      381
12.1       336
12.2       356
12.3       370
12.4       377
12.5       389
12.6       402
12.7       411
12.8       420
12.9       426
12.10      429
13.1       342
13.2       353
13.3       365
13.4       372
13.5       384
13.6       392
13.7       399
13.8       408
13.9       414
13.10      417



/;

parameter ta(f,u)
/
1.2        199
1.3        213
1.4        222
1.5        229
1.6        235
1.7        242
1.8        246
1.9        253
1.10       260
1.11       267
2.2        209
2.3        219
2.4        231
2.5        242
2.6        248
2.7        255
2.8        262
2.9        270
2.10       273
2.11       279
3.2        222
3.3        236
3.4        245
3.5        255
3.6        265
3.7        272
3.8        276
3.9        280
3.10       283
3.11       291
4.2        242
4.3        252
4.4        264
4.5        278
4.6        288
4.7        295
4.8        300
4.9        304
4.10       307
4.11       312
5.2        250
5.3        264
5.4        272
5.5        283
5.6        293
5.7        300
5.8        304
5.9        308
5.10       311
5.11       319
6.2        258
6.3        269
6.4        278
6.5        289
6.6        303
6.7        314
6.8        321
6.9        330
6.10       334
6.11       340
7.2        268
7.3        278
7.4        290
7.5        304
7.6        317
7.7        328
7.8        332
7.9        336
7.10       342
7.11       352
8.2        287
8.3        297
8.4        306
8.5        316
8.6        326
8.7        333
8.8        340
8.9        348
8.10       351
8.11       357
9.2        316
9.3        326
9.4        335
9.5        345
9.6        363
9.7        374
9.8        381
9.9        389
9.10       392
9.11       398
10.2       328
10.3       343
10.4       351
10.5       365
10.6       378
10.7       389
10.8       393
10.9       397
10.10      400
10.11      406
11.2       331
11.3       338
11.4       343
11.5       350
11.6       356
11.7       363
11.8       370
11.9       378
11.10      381
11.11      389
12.2       350
12.3       368
12.4       377
12.5       387
12.6       400
12.7       411
12.8       418
12.9       426
12.10      429
12.11      437
13.2       353
13.3       363
13.4       372
13.5       382
13.6       392
13.7       399
13.8       406
13.9       414
13.10      417
13.11      425


/;


parameter te(i)
/
1       0
2       0
3       0
4       0
5       0
6       0
7       0
8       0
9       0
10      0
11      0
12      0
13      0


14      180
15      180
16      180


/;



parameter tl(i)
/
1       0
2       0
3       0
4       0
5       0
6       0
7       0
8       0
9       0
10      0
11      0
12      0
13      0


14      360
15      360
16     360

/;




parameter M;
M=99999;

parameter penalty;
penalty=1000;

parameter new_tr(i,u)
/
1.1        12
1.2        10
1.3        5
1.4        7
1.5        6
1.6        6
1.7        4
1.8        6
1.9        5
1.10       6
1.11       5
2.1        10
2.2        9
2.3        7
2.4        8
2.5        6
2.6        6
2.7        6
2.8        6
2.9        3
2.10       5
2.11       5
3.1        12
3.2        10
3.3        5
3.4        9
3.5        7
3.6        6
3.7        5
3.8        4
3.9        3
3.10       7
3.11       5
4.1        11
4.2        10
4.3        9
4.4        12
4.5        8
4.6        6
4.7        5
4.8        4
4.9        3
4.10       6
4.11       5
5.1        12
5.2        10
5.3        5
5.4        10
5.5        7
5.6        6
5.7        5
5.8        4
5.9        3
5.10       7
5.11       5
6.1        11
6.2        10
6.3        6
6.4        10
6.5        10
6.6        8
6.7        6
6.8        6
6.9        4
6.10       5
6.11       5
7.1        10
7.2        9
7.3        7
7.4        10
7.5        9
7.6        7
7.7        4
7.8        4
7.9        5
7.10       6
7.11       5
8.1        10
8.2        9
8.3        5
8.4        9
8.5        7
8.6        6
8.7        7
8.8        5
8.9        3
8.10       5
8.11       5
9.1        10
9.2        9
9.3        5
9.4        9
9.5        9
9.6        7
9.7        6
9.8        5
9.9        3
9.10       5
9.11       5
10.1       12
10.2       8
10.3       6
10.4       10
10.5       9
10.6       7
10.7       5
10.8       4
10.9       3
10.10      5
10.11      5
11.1       10
11.2       7
11.3       4
11.4       7
11.5       6
11.6       6
11.7       7
11.8       6
11.9       3
11.10      8
11.11      5
12.1       12
12.2       10
12.3       5
12.4       9
12.5       9
12.6       7
12.7       6
12.8       5
12.9       3
12.10      7
12.11      5
13.1       10
13.2       9
13.3       6
13.4       9
13.5       7
13.6       6
13.7       6
13.8       5
13.9       3
13.10      7
13.11      5


14.1        12
14.2        10
14.3        9
14.4        12
14.5        10
14.6        7
14.7        7
14.8        6
14.9        5
14.10       7
14.11       5
15.1        12
15.2        10
15.3        9
15.4        12
15.5        10
15.6        7
15.7        7
15.8        6
15.9        5
15.10       7
15.11       5
16.1        12
16.2        10
16.3        9
16.4        12
16.5        10
16.6        7
16.7        7
16.8        6
16.9        5
16.10       7
16.11       5


/;


parameter new_stop_min;
new_stop_min=2;

parameter  new_stop_max;
new_stop_max=15;

parameter hd;
hd=4;

parameter ha;
ha=4;

parameter R;
R=1;


variable
obj;

variables
new_td(i,u)
new_ta(i,u);

binary variables
y(i,j,u);

equations

         def_obj
         new_train_td_min(i)
         new_train_td_max(i)
         new_train_min_stop_time(i,u)
         new_train_max_stop_time(i,u)
         new_train_arr_time(i,u)
         new_dep_time(i,f,u)
         new_arr_time(i,f,u)
         all_train_dep_time_1(i,j,u)
         all_train_arr_time_1(i,j,u)
         all_train_y(i,j,u);

def_obj..   obj=e=sum((i)$(flag(i)=0), new_ta(i,'11')- new_td(i,'1'));
new_train_td_min(i)$(flag(i)=0).. new_td(i,'1')=g=te(i);
new_train_td_max(i)$(flag(i)=0).. new_td(i,'1')=l=tl(i);
new_train_min_stop_time(i,u)$(flag(i)=0 and u.val>1 and u.val<11).. (new_td(i,u)-new_ta(i,u))=g=s_orr(i,u)*new_stop_min;
new_train_max_stop_time(i,u)$(flag(i)=0 and u.val>1 and u.val<11).. (new_td(i,u)-new_ta(i,u))=l=s_orr(i,u)*new_stop_max;
new_train_arr_time(i,u)$(flag(i)=0 and u.val<11).. new_ta(i,u+1)=e=new_td(i,u)+new_tr(i,u)+R*(s_orr(i,u)+s_orr(i,u+1));
new_dep_time(i,f,u)$(f.val=i.val and u.val<11).. new_td(i,u)=e=td(f,u);
new_arr_time(i,f,u)$(f.val=i.val and u.val>1).. new_ta(i,u)=e=ta(f,u);
all_train_dep_time_1(i,j,u)$(((flag(i)=1 and flag(j)=0)or(flag(i)=0 and flag(j)=0)or(flag(i)=0 and flag(j)=1)) and (u.val<11 and i.val<>j.val)).. new_td(j,u)-new_td(i,u)+(1-y(i,j,u))*M=g=hd;
all_train_arr_time_1(i,j,u)$(((flag(i)=1 and flag(j)=0)or(flag(i)=0 and flag(j)=0)or(flag(i)=0 and flag(j)=1)) and (u.val<11 and i.val<>j.val)).. new_ta(j,u+1)-new_ta(i,u+1)+(1-y(i,j,u))*M=g=ha;
all_train_y(i,j,u)$(((flag(i)=1 and flag(j)=0)or(flag(i)=0 and flag(j)=0)or(flag(i)=0 and flag(j)=1)) and (u.val<11 and i.val<>j.val)).. y(i,j,u)+y(j,i,u)=e=1;


Model new_express_train /all/;

solve new_express_train USING MIP MINIMIZING obj;

display obj.l,new_td.l,new_ta.l;

